<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jason's Homepage</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/astronomy-engine@2.1.19/astronomy.browser.js"></script>
  </head>
  <body>
    <div class="page-wrapper">
      <a href="#main" class="skip-to-main">Skip to main content</a>
      
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/games/">Games</a></li>
          <li><a href="/tools/">Tools</a></li>
          <li><a href="/simulators/">Simulators</a></li>
          <li><a href="/lab/">Lab</a></li>
        </ul>
      </nav>

      <main id="main">
        <div class="container">
          <h1>ğŸ‘‹ Welcome!</h1>
          <p class="subtitle">Explore my projects and tools</p>
          
          <h2 style="text-align: left;">Categories</h2>
          <div class="categories-grid">
            <a href="/games/" class="category-card">
              <div class="category-icon">ğŸ®</div>
              <div class="category-title">Games</div>
              <p class="category-description">Interactive games and experiments</p>
            </a>
            
            <a href="/tools/" class="category-card">
              <div class="category-icon">ğŸ› ï¸</div>
              <div class="category-title">Tools</div>
              <p class="category-description">Useful utilities and converters</p>
            </a>
            
            <a href="/simulators/" class="category-card">
              <div class="category-icon">âš™ï¸</div>
              <div class="category-title">Simulators</div>
              <p class="category-description">Physics and system simulations</p>
            </a>
            
            <a href="/lab/" class="category-card">
              <div class="category-icon">ğŸ”¬</div>
              <div class="category-title">Lab</div>
              <p class="category-description">Experimental projects and research</p>
            </a>
          </div>

          <h2 style="text-align: left; margin-top: 3rem;">Live Data</h2>
          
          <div class="widgets">
            <div class="widget">
              <div class="widget-title">ğŸŒ™ Moon Phase</div>
              <div class="moon-emoji" id="moonEmoji">ğŸŒ•</div>
              <div class="widget-value" id="moonPhase"><span class="loading">Loading...</span></div>
              <div class="widget-description" id="moonDescription"></div>
            </div>
            
            <div class="widget">
              <div class="widget-title">ğŸŒ¡ï¸ Temperature in Bonn</div>
              <div class="temp-emoji" id="tempEmoji">ğŸŒ¤ï¸</div>
              <div class="widget-value" id="temperature"><span class="loading">Loading...</span></div>
              <div class="widget-description" id="tempDescription"></div>
            </div>
            
            <div class="widget">
              <div class="widget-title">âš¡ Space Weather (Kp)</div>
              <div class="kp-emoji" id="kpEmoji">ğŸŒŒ</div>
              <div class="widget-value" id="kpIndex"><span class="loading">Loading...</span></div>
              <div class="widget-description" id="kpDescription"></div>
              <div id="kpLevel" class="kp-level"></div>
            </div>
          </div>
          
          <p style="color: #999; font-size: 0.9em; margin-top: 30px;">Last updated: <span id="lastUpdated">Just now</span></p>
          
          <div class="celestial-section">
            <div class="celestial-title">â˜€ï¸ ğŸŒ™ Sun & Moon (Bonn)</div>
            <div class="celestial-grid">
              <div class="celestial-object">
                <div class="celestial-name">â˜€ï¸ Sun</div>
                <div class="celestial-info">
                  <div class="celestial-info-row">
                    <span class="celestial-label">Azimuth:</span>
                    <span class="celestial-value" id="sunAzimuth">--Â°</span>
                  </div>
                  <div class="celestial-info-row">
                    <span class="celestial-label">Elevation:</span>
                    <span class="celestial-value" id="sunElevation">--Â°</span>
                  </div>
                  <div class="celestial-info-row">
                    <span class="celestial-label">Rise:</span>
                    <span class="celestial-value" id="sunRise">--:--</span>
                  </div>
                  <div class="celestial-info-row">
                    <span class="celestial-label">Set:</span>
                    <span class="celestial-value" id="sunSet">--:--</span>
                  </div>
                </div>
              </div>
              
              <div class="celestial-object moon">
                <div class="celestial-name">ğŸŒ™ Moon</div>
                <div class="celestial-info">
                  <div class="celestial-info-row">
                    <span class="celestial-label">Azimuth:</span>
                    <span class="celestial-value" id="moonAzimuth">--Â°</span>
                  </div>
                  <div class="celestial-info-row">
                    <span class="celestial-label">Elevation:</span>
                    <span class="celestial-value" id="moonElevation">--Â°</span>
                  </div>
                  <div class="celestial-info-row">
                    <span class="celestial-label">Rise:</span>
                    <span class="celestial-value" id="moonRise">--:--</span>
                  </div>
                  <div class="celestial-info-row">
                    <span class="celestial-label">Set:</span>
                    <span class="celestial-value" id="moonSet">--:--</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="translation-section">
            <div class="translation-title">ğŸŒ Text Translator</div>
            
            <div class="translation-container">
              <div class="translation-box">
                <div class="translation-label">
                  From:
                  <select id="sourceLang" class="language-select">
                    <option value="auto">Auto-detect</option>
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="pt">Portuguese</option>
                    <option value="nl">Dutch</option>
                    <option value="pl">Polish</option>
                    <option value="ru">Russian</option>
                    <option value="ja">Japanese</option>
                    <option value="zh">Chinese (Simplified)</option>
                    <option value="ko">Korean</option>
                    <option value="ar">Arabic</option>
                    <option value="hi">Hindi</option>
                  </select>
                </div>
                <textarea id="sourceText" placeholder="Enter text to translate..."></textarea>
                <div class="character-count"><span id="sourceCount">0</span>/5000</div>
              </div>
              
              <div class="translation-box">
                <div class="translation-label">
                  To:
                  <select id="targetLang" class="language-select">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="pt">Portuguese</option>
                    <option value="nl">Dutch</option>
                    <option value="pl">Polish</option>
                    <option value="ru">Russian</option>
                    <option value="ja">Japanese</option>
                    <option value="zh">Chinese (Simplified)</option>
                    <option value="ko">Korean</option>
                    <option value="ar">Arabic</option>
                    <option value="hi">Hindi</option>
                  </select>
                </div>
                <textarea id="translatedText" placeholder="Translation will appear here..." readonly></textarea>
                <div class="character-count"><span id="targetCount">0</span>/5000</div>
              </div>
            </div>
            
            <div class="translation-controls">
              <button id="translateBtn">Translate</button>
              <button id="swapBtn" class="swap-btn">â‡„ Swap</button>
              <button id="copyBtn" class="copy-btn">ğŸ“‹ Copy</button>
            </div>
            
            <div id="translationStatus" class="translation-status"></div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Fetch Moon Phase Data
      async function getMoonPhase() {
        try {
          const today = new Date();
          const phases = ['ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜'];
          const phaseNames = ['New Moon', 'Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 'Full Moon', 'Waning Gibbous', 'Last Quarter', 'Waning Crescent'];
          
          // Simple moon phase calculation
          const knownNewMoon = new Date(2000, 0, 6);
          const moonCycle = 29.53;
          const daysSinceNewMoon = (today - knownNewMoon) / (1000 * 60 * 60 * 24);
          const phaseIndex = Math.floor((daysSinceNewMoon % moonCycle) / (moonCycle / 8)) % 8;
          
          document.getElementById('moonEmoji').textContent = phases[phaseIndex];
          document.getElementById('moonPhase').textContent = phaseNames[phaseIndex];
          document.getElementById('moonDescription').textContent = `${Math.round((daysSinceNewMoon % moonCycle) / moonCycle * 100)}% illuminated`;
        } catch (error) {
          document.getElementById('moonPhase').innerHTML = '<span class="error">Unable to calculate</span>';
        }
      }

      // Fetch Temperature in Bonn
      async function getTemperature() {
        try {
          const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=50.7353&longitude=7.0622&current=temperature_2m,weather_code&timezone=auto');
          const data = await response.json();
          const temp = data.current.temperature_2m;
          const weatherCode = data.current.weather_code;
          
          // Map weather code to emoji
          let emoji = 'ğŸŒ¤ï¸';
          if (weatherCode === 0 || weatherCode === 1) emoji = 'â˜€ï¸';
          else if (weatherCode === 2 || weatherCode === 3) emoji = 'â›…';
          else if (weatherCode >= 45) emoji = 'ğŸŒ§ï¸';
          
          document.getElementById('tempEmoji').textContent = emoji;
          document.getElementById('temperature').textContent = `${temp}Â°C`;
          document.getElementById('tempDescription').textContent = 'In Bonn, Germany';
        } catch (error) {
          document.getElementById('temperature').innerHTML = '<span class="error">Unable to fetch</span>';
        }
      }

      // Fetch Space Weather Data (Kp Index)
      async function getSpaceWeather() {
        try {
          const response = await fetch('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json');
          const data = await response.json();
          
          if (data && data.length > 0) {
            // Get the latest measurement
            const latest = data[data.length - 1];
            const kpValue = latest.kp_index;
            
            // Map Kp index to emoji and level
            let emoji = 'ğŸŒŒ';
            let levelClass = 'kp-low';
            let levelText = 'Quiet';
            
            if (kpValue < 3) {
              emoji = 'ğŸŸ¢';
              levelClass = 'kp-low';
              levelText = 'Quiet';
            } else if (kpValue < 6) {
              emoji = 'ğŸŸ¡';
              levelClass = 'kp-moderate';
              levelText = 'Moderate';
            } else {
              emoji = 'ğŸ”´';
              levelClass = 'kp-high';
              levelText = 'Active/Storm';
            }
            
            document.getElementById('kpEmoji').textContent = emoji;
            document.getElementById('kpIndex').textContent = kpValue;
            document.getElementById('kpDescription').textContent = 'Planetary Kp Index';
            
            const kpLevel = document.getElementById('kpLevel');
            kpLevel.textContent = levelText;
            kpLevel.className = `kp-level ${levelClass}`;
          }
        } catch (error) {
          document.getElementById('kpIndex').innerHTML = '<span class="error">Unable to fetch</span>';
          console.error('Space weather error:', error);
        }
      }

      // Update last modified time
      function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        document.getElementById('lastUpdated').textContent = timeString;
      }

      // Get celestial rise/set times and current position
      async function getCelestialData() {
        try {
          // Bonn coordinates
          const latitude = 50.7353;
          const longitude = 7.0622;
          const elevation = 58; // meters
          
          // Calculate current Sun and Moon position using astronomy-engine
          // Check for Astronomy library - it might be under window.Astronomy or global Astronomy
          const AstronomyLib = window.Astronomy || typeof Astronomy !== 'undefined' ? Astronomy : null;
          
          if (AstronomyLib) {
            const observer = new AstronomyLib.Observer(latitude, longitude, elevation);
            const now = new Date();
            
            // Get sun rise/set for today
            try {
              const sunRise = AstronomyLib.SearchRiseSet('Sun', observer, 1, now, 300);
              if (sunRise && sunRise.date) {
                document.getElementById('sunRise').textContent = sunRise.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
              } else {
                console.log('Sun rise data:', sunRise);
              }
              
              const sunSet = AstronomyLib.SearchRiseSet('Sun', observer, -1, now, 300);
              if (sunSet && sunSet.date) {
                document.getElementById('sunSet').textContent = sunSet.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
              } else {
                console.log('Sun set data:', sunSet);
              }
            } catch (e) {
              console.warn('Error getting sun times:', e);
            }
            
            // Sun position
            try {
              const sunNow = AstronomyLib.Equator('Sun', now, observer, false, true);
              const sunHorizontal = AstronomyLib.Horizon(now, observer, sunNow.ra, sunNow.dec);
              
              document.getElementById('sunAzimuth').textContent = Math.round(sunHorizontal.azimuth) + 'Â°';
              document.getElementById('sunElevation').textContent = Math.round(sunHorizontal.altitude) + 'Â°';
            } catch (e) {
              console.warn('Error getting sun position:', e);
            }
            
            // Get moon rise/set for today
            try {
              const moonRise = AstronomyLib.SearchRiseSet('Moon', observer, 1, now, 300);
              if (moonRise && moonRise.date) {
                document.getElementById('moonRise').textContent = moonRise.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                console.log('Moon rise set to:', moonRise.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
              } else {
                console.log('Moon rise result:', moonRise);
              }
              
              const moonSet = AstronomyLib.SearchRiseSet('Moon', observer, -1, now, 300);
              if (moonSet && moonSet.date) {
                document.getElementById('moonSet').textContent = moonSet.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                console.log('Moon set set to:', moonSet.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
              } else {
                console.log('Moon set result:', moonSet);
              }
            } catch (e) {
              console.warn('Error getting moon times:', e);
            }
            
            // Moon position
            try {
              const moonNow = AstronomyLib.Equator('Moon', now, observer, false, true);
              const moonHorizontal = AstronomyLib.Horizon(now, observer, moonNow.ra, moonNow.dec);
              
              document.getElementById('moonAzimuth').textContent = Math.round(moonHorizontal.azimuth) + 'Â°';
              document.getElementById('moonElevation').textContent = Math.round(moonHorizontal.altitude) + 'Â°';
            } catch (e) {
              console.warn('Error getting moon position:', e);
            }
          } else {
            console.warn('Astronomy library not loaded');
          }
        } catch (error) {
          console.error('Error in getCelestialData:', error);
        }
      }

      // Initial load
      getMoonPhase();
      getTemperature();
      getSpaceWeather();
      getCelestialData();
      updateTime();

      // Refresh data every 5 minutes
      setInterval(() => {
        getMoonPhase();
        getTemperature();
        getSpaceWeather();
        getCelestialData();
        updateTime();
      }, 5 * 60 * 1000);

      // Translation Feature
      const sourceText = document.getElementById('sourceText');
      const translatedText = document.getElementById('translatedText');
      const sourceLang = document.getElementById('sourceLang');
      const targetLang = document.getElementById('targetLang');
      const translateBtn = document.getElementById('translateBtn');
      const swapBtn = document.getElementById('swapBtn');
      const copyBtn = document.getElementById('copyBtn');
      const sourceCount = document.getElementById('sourceCount');
      const targetCount = document.getElementById('targetCount');
      const translationStatus = document.getElementById('translationStatus');

      // Update character count
      sourceText.addEventListener('input', () => {
        sourceCount.textContent = sourceText.value.length;
      });

      translatedText.addEventListener('input', () => {
        targetCount.textContent = translatedText.value.length;
      });

      // Translate function using free API
      async function translate() {
        const text = sourceText.value.trim();
        
        if (!text) {
          showStatus('Please enter text to translate', 'error');
          return;
        }

        if (text.length > 5000) {
          showStatus('Text exceeds 5000 characters', 'error');
          return;
        }

        showStatus('Translating...', 'loading');
        
        try {
          const source = sourceLang.value === 'auto' ? 'auto' : sourceLang.value;
          const target = targetLang.value;

          // Using MyMemory Translation API (free, no key required)
          const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${source}|${target}`;
          
          const response = await fetch(url);
          const data = await response.json();

          if (data.responseStatus === 200) {
            translatedText.value = data.responseData.translatedText;
            targetCount.textContent = data.responseData.translatedText.length;
            showStatus('Translation successful!', 'success');
          } else {
            showStatus('Translation failed. Please try again.', 'error');
          }
        } catch (error) {
          showStatus('Error: Unable to connect to translation service', 'error');
          console.error('Translation error:', error);
        }
      }

      function showStatus(message, type) {
        translationStatus.textContent = message;
        translationStatus.className = `translation-status show ${type}`;
        
        if (type !== 'loading') {
          setTimeout(() => {
            translationStatus.classList.remove('show');
          }, 3000);
        }
      }

      function swapLanguages() {
        // Swap languages
        const temp = sourceLang.value;
        sourceLang.value = targetLang.value;
        targetLang.value = temp;

        // Swap texts
        const tempText = sourceText.value;
        sourceText.value = translatedText.value;
        translatedText.value = tempText;

        // Update counts
        sourceCount.textContent = sourceText.value.length;
        targetCount.textContent = translatedText.value.length;
      }

      function copyToClipboard() {
        if (!translatedText.value) {
          showStatus('Nothing to copy', 'error');
          return;
        }

        navigator.clipboard.writeText(translatedText.value).then(() => {
          showStatus('Copied to clipboard!', 'success');
        }).catch(() => {
          showStatus('Failed to copy', 'error');
        });
      }

      // Event listeners
      translateBtn.addEventListener('click', translate);
      swapBtn.addEventListener('click', swapLanguages);
      copyBtn.addEventListener('click', copyToClipboard);

      // Allow Enter key to translate (Ctrl+Enter)
      sourceText.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'Enter') {
          translate();
        }
      });
    </script>
  </body>
</html>
